<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chariot Tracker</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 20px; }
    #status { margin-top: 20px; font-weight: bold; color: green; }
  </style>
</head>
<body>
  <h1>Chariot GPS Tracker</h1>
  <p>This page will send the chariot's live location to the server.</p>
  <div id="status">Initializing...</div>

  <script>
    const chariotId = new URLSearchParams(window.location.search).get("chariot_id") || "demo";

    function updateStatus(message, isError = false) {
      const status = document.getElementById("status");
      status.style.color = isError ? "red" : "green";
      status.textContent = message;
    }

    if (!navigator.geolocation) {
      updateStatus("Geolocation is not supported by your browser.", true);
    } else {
      updateStatus("Requesting GPS location...");
      navigator.geolocation.watchPosition(
        (position) => {
          const data = {
            chariotId,
            lat: position.coords.latitude,
            lng: position.coords.longitude,
            timestamp: new Date().toISOString(),
          };

          fetch("https://yourdomain.com/api/update-location", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          })
            .then((res) => {
              if (res.ok) {
                updateStatus(`Location sent: ${data.lat.toFixed(5)}, ${data.lng.toFixed(5)}`);
              } else {
                updateStatus("Failed to send location.", true);
              }
            })
            .catch(() => updateStatus("Error sending location.", true));
        },
        (err) => {
          updateStatus("Error accessing location: " + err.message, true);
        },
        { enableHighAccuracy: true, maximumAge: 10000, timeout: 10000 }
      );
    }
  </script>
</body>
</html>
